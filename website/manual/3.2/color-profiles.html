---
layout: manual_3.2
title: Color Profiles
---

<ol class="breadcrumb">
  <li><a href="{{ site.baseurl }}/">Home</a></li>
  <li><a href="{{ site.baseurl }}/manual/">User Manual</a></li>
  <li><a href="{{ site.baseurl }}/manual/3.2/">3.2</a></li>
  <li class="active">Color Profiles</li>
</ol>

<h1>Color Profiles</h1>

<ul>
  <li><a href="#Overview">Overview</a></li>
  <li><a href="#Profiles in Source Images">Profiles in Source Images</a></li>
  <li>
    <a href="#Profiles in Derivative Images">Profiles in Derivative Images</a>
    <ul>
      <li><a href="#Modes of Operation">Modes of Operation</a>
        <ul>
            <li><a href="#BasicStrategy">BasicStrategy</a></li>
            <li><a href="#ScriptStrategy">ScriptStrategy</a></li>
        </ul>
      </li>
      <li><a href="#Processor%20Support">Processor Support</a></li>
      <li><a href="#Implications">Implications</a>
        <ul>
          <li><a href="#Caching">Caching</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="Overview">Overview</h2>

<p>ICC color profiles are small files, or chunks of data, that define transformations from one color space to another. Color profiles can be inserted at various stages in an image processing workflow&mdash;from scanner to computer, computer to printer, and even monitor to eye&mdash;to ensure that accurate colors are maintained throughout the workflow.</p>

<p>Color profiles can also be embedded within image files, for the purpose of mapping the color space in which an image was produced to its internal color data. This enables viewers to reproduce image colors accurately, as they were seen by the producer. By embedding a profile, the producer need not know anything about the displays on which an image will be viewed, and need not destructively modify the color values within the image data itself.</p>

<hr>

<h2 id="Profiles in Source Images">Profiles in Source Images</h2>

<p>All Cantaloupe processors that handle images automatically respect embedded ICC profiles in source images and use them to interpret image data. Nothing more needs to be done.</p>

<hr>

<h2 id="Profiles in Derivative Images">Profiles in Derivative Images</h2>

<p>Most Cantaloupe processors are also capable of embedding ICC color profiles into derivative (output) images.</p>

<p>Note that one color profile in particular, sRGB, has become a "de facto" standard profile on the World Wide Web. There is typically no need to embed an sRGB profile into profile-less images, as viewers will tend to automatically assume that these map to an sRGB space, and apply the conversion themselves. Embedded profiles are therefore disabled by default.</p>

<h3 id="Modes of Operation">Modes of Operation</h3>

<p>There are two "strategies," or ways of configuring the embedding process: a basic strategy, where the same profile is embedded in all derivative images; and a <a href="#ScriptStrategy">script strategy</a>, where the decision whether or not to embed a profile, and which one to embed, depends on the return value of a delegate script method. The <code>metadata.icc.strategy</code> configuration key is used to set the strategy.</p>

<h4 id="BasicStrategy">BasicStrategy</h4>

<p>With BasicStrategy, the <code>metadata.icc.BasicStrategy.*</code> keys in the configuration file are used to refer to a profile. This strategy is easy to configure and works well when you intend for the same profile to be embedded in all images.</p>

<h4 id="ScriptStrategy">ScriptStrategy</h4>

<p>Perhaps you only want to embed a profile into some images, and not others; or you want to embed a different profile based on a client's user agent. Or, perhaps you only want to embed a profile in JPEG output images, and not GIFs. All of this is possible by writing just a few lines of code.</p>

<p>With the <code>Cantaloupe::icc_profile</code> delegate script method, you can tell the image server whether or not to embed a profile, and what profile to embed, in response to a particular request, An example of how this can be accomplished appears below:</p>

{% highlight ruby %}
module Cantaloupe
  ##
  # See the argument & return value documentation in delegates.rb.sample.
  #
  def self.icc_profile(identifier, output_format, request_headers, client_ip)
    # Don't embed a profile in GIF images.
    return {} if output_format['media_type'] == 'image/gif'

    # Don't embed a profile into images of cantaloupes.
    return {} if identifier.downcase.include?('cantaloupe')

    # Embed a different profile for certain clients based on their
    # User-Agent header.
    if request_headers.
        select{ |k,v| k.downcase == 'user-agent' and v.include?('MyUserAgent') }.any?
      return {
        'pathname' => '/path/to/AdobeRGB1998.icc',
        'name' => 'AdobeRGB1998'
      }
    end

    # Don't embed a profile for all other requests.
    {}
  end
end
{% endhighlight %}

<h3 id="Processor Support">Processor Support</h3>

<p>Most processors support embedded color profiles; see the <a href="processors.html#Supported%20Features">table of processor-supported features</a>.</p>

<h3 id="Implications">Implications</h3>

<h4 id="Caching">Caching</h4>

<p>Profile properties are encoded in cached-image identifiers. When profile settings change, cached images with profiles will be re-generated automatically, and images with different profile settings (when using <a href="#ScriptStrategy">ScriptStrategy</a>) will be cached separately.</p>
